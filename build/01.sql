CREATE TABLE IF NOT EXISTS `users` (
	`userID` SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	`username` VARCHAR(32) NOT NULL,
	`displayname` VARCHAR(32) NOT NULL,
	`password` CHAR(32) NOT NULL,
	`active` TINYINT(1) UNSIGNED NOT NULL DEFAULT 1,
	`permission` TINYINT UNSIGNED NOT NULL DEFAULT 1,
	`lastLogin` TIMESTAMP,
	ADD CONSTRAINT username_ux UNIQUE (`username`),
	ADD CONSTRAINT displayname_ux UNIQUE (`displayname`)
) ENGINE = InnoDB CHARACTER SET utf8 COLLATE utf8_general_ci;

CREATE TABLE IF NOT EXISTS `api_keys` (
	`keyID` SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	`key` CHAR(40) NOT NULL,
	`owner` SMALLINT UNSIGNED NOT NULL,
	`active` TINYINT(1) UNSIGNED NOT NULL DEFAULT 1,
	ADD CONSTRAINT api_key_ux UNIQUE (`key`),
	FOREIGN KEY(`owner`) REFERENCES users(`owner`) ON DELETE CASCADE
) ENGINE == InnoDB CHARACTER SET utf8 COLLATE utf8_general_ci;

--TODO: make token the primary key
CREATE TABLE IF NOT EXISTS `sessions` (
	`sessionID` INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	`created` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`key` SMALLINT UNSIGNED NOT NULL,
	`expiry` TIMESTAMP NOT NULL,
	`token` CHAR(40) NOT NULL,
	`totalRequests` INT UNSIGNED NOT NULL DEFAULT 0,
	ADD CONSTRAINT session_token_ux UNIQUE (`token`),
	FOREIGN KEY(`key`) REFERENCES api_keys(`keyID`) ON DELETE CASCADE
) ENGINE = InnoDB CHARACTER SET utf8 COLLATE utf8_general_ci;

CREATE TABLE IF NOT EXISTS `main_data` (
	`id` INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	`dateRecorded` DATETIME NOT NULL,
	`text` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
	`owner` SMALLINT UNSIGNED NOT NULL,
	`archived` TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
	FOREIGN KEY(`owner`) REFERENCES users(`userID`) ON DELETE CASCADE
) ENGINE = InnoDB CHARACTER SET utf8 COLLATE utf8_general_ci;

